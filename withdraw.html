<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Withdraw - Red Rose üåπ</title>
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  

  <main class="main-content">
    <h1>Withdraw</h1>

    <div class="balance-card">
      <p>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
      <h2 id="withdrawable-balance">0‡ß≥</h2>
    </div>
    
    <div class="note-card">
      <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤ ‡¶π‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ì ‡ßß‡ß¶‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®
</p>
    </div>

    <div class="country-selector">
      <label>‡¶¶‡ßá‡¶∂ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
      <select id="country-select" class="input-field">
        <option value="bd">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ (+880)</option>
        <option value="pk">‡¶™‡¶æ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶® (+92)</option>
        <option value="in">‡¶≠‡¶æ‡¶∞‡¶§ (+91)</option>
      </select>
    </div>

    <div class="withdraw-card">
      <h3>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°</h3>
      <div class="method-group" id="method-group">
        </div>

      <div class="phone-input-group">
        <span id="country-code" class="country-code">+880</span>
        <input type="text" id="phone-number" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="input-field phone-input" maxlength="10" />
      </div>
      
      <p id="zero-error-message" class="status-text zero-error-text"></p>

      <div id="amount-selector-container" class="amount-selector-container">
        <input type="hidden" id="amount" value="100" />
      </div>
      
      <button id="withdraw-btn" class="btn-primary">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <p id="status-message" class="status-text"></p>
    </div>

    <div class="history-section">
      <h3>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</h3>
      <div id="history-list" class="history-list"></div>
    </div>
  </main>

  <nav class="bottom-nav">
    <button class="nav-item" onclick="goToHome()">Home</button>
    <button class="nav-item" onclick="goToSupport()">Support</button>
    <button class="nav-item" onclick="goToNews()">News</button>
    <button class="nav-item active">Withdraw</button>
     <button class="nav-item"onclick="goToProfile()">Profile</button>
 
  </nav>

 <script>
// withdraw.html ‡¶è‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü

const firebaseConfig = {
    apiKey: "AIzaSyBQf-ILFW6jDV-c_O2LG6elA5oAB84p2XQ",
    authDomain: "top-news-91db8.firebaseapp.com",
    databaseURL: "https://top-news-91db8-default-rtdb.firebaseio.com",
    projectId: "top-news-91db8",
    storageBucket: "top-news-91db8.firebasestorage.app",
    messagingSenderId: "348369077928",
    appId: "1:348369077928:web:7629c503c30cbf7450649d",
    measurementId: "G-7GMX8N2NSC"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const tg = window.Telegram.WebApp;
tg.ready(); tg.expand();

const user = tg.initDataUnsafe.user;
const userId = user?.id.toString() || 'unknown';
const userRef = db.collection('users').doc(userId);
let userData = {};

// ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® (‡ß¶ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ)
const phoneNumberInput = document.getElementById('phone-number');
const zeroErrorMessage = document.getElementById('zero-error-message');

phoneNumberInput.addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, ''); 
    if (this.value.length > 0 && this.value.startsWith('0')) {
        this.value = this.value.substring(1); // ‡ß¶ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠
        zeroErrorMessage.textContent = '‚ö†Ô∏è ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡ß¶ ‡¶¶‡¶ø‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§';
        zeroErrorMessage.style.display = 'block';
    } else {
        zeroErrorMessage.style.display = 'none';
    }
});

// ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶®
// üî• ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: window.location.href ‡¶ï‡¶≤‡¶ï‡ßá setTimeout-‡¶è ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã
function goToHome() { setTimeout(() => window.location.href = 'index.html', 0); }
function goToSupport() { setTimeout(() => window.location.href = 'support.html', 0); }
function goToNews() { setTimeout(() => window.location.href = 'news.html', 0); } // ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶¨‡¶æ‡¶®‡¶æ‡¶® ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
function goToWithdraw() { setTimeout(() => window.location.href = 'withdraw.html', 0); }
function goToProfile() { setTimeout(() => window.location.href = 'profile.html', 0); }
// üî• ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶∂‡ßá‡¶∑

// ‡¶ï‡¶æ‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ï‡¶®‡¶´‡¶ø‡¶ó
const countries = {
  bd: { code: '+880', maxLength: 10, methods: ['bKash', 'Nagad'], methodNames: { bKash: '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂', Nagad: '‡¶®‡¶ó‡¶¶' } },
  pk: { code: '+92', maxLength: 10, methods: ['JazzCash'], methodNames: { JazzCash: 'JazzCash' } },
  in: { code: '+91', maxLength: 10, methods: ['Paytm'], methodNames: { Paytm: 'Paytm' } }
};
let selectedCountry = 'bd';
let selectedMethod = 'bKash';
let selectedAmount = 100;

// ‡¶Æ‡ßá‡¶•‡¶° ‡¶≤‡ßã‡¶°‡¶æ‡¶∞
function loadMethods(config) {
  const group = document.getElementById('method-group');
  group.innerHTML = '';
  selectedMethod = config.methods[0]; 
  config.methods.forEach(method => {
    const btn = document.createElement('button');
    btn.className = 'method-btn ' + (method === selectedMethod ? 'active' : '');
    btn.textContent = config.methodNames[method];
    btn.onclick = () => {
      document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedMethod = method;
    };
    group.appendChild(btn);
  });
  document.getElementById('country-code').textContent = config.code;
  phoneNumberInput.maxLength = config.maxLength;
  phoneNumberInput.placeholder = `${config.maxLength} ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®`;
}

// ‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡¶∞
function loadAmountSelector() {
    const container = document.getElementById('amount-selector-container');
    // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
    container.innerHTML = '<input type="hidden" id="amount" value="100" />';
    
    const grid = document.createElement('div');
    grid.className = 'amount-selector-grid';
    [100, 200, 500, 1000].forEach(amt => {
        const btn = document.createElement('button');
        btn.className = 'amount-btn ' + (amt === 100 ? 'active' : '');
        btn.textContent = `${amt}‡ß≥`;
        btn.onclick = () => {
            document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            selectedAmount = amt;
        };
        grid.appendChild(btn);
    });
    container.appendChild(grid);
}

// ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
document.getElementById('withdraw-btn').onclick = async () => {
    const status = document.getElementById('status-message');
    const phone = phoneNumberInput.value.trim();
    status.textContent = '';

    if (userData.isBanned) {
        status.textContent = '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶°!'; status.style.color = 'red'; return;
    }
    
    const config = countries[selectedCountry];
    if (phone.length !== config.maxLength) {
        status.textContent = `‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ${config.maxLength} ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`;
        status.style.color = 'red';
        return;
    }

    // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶ö‡ßá‡¶ï
    const doc = await userRef.get();
    const data = doc.data();
    const balance = data.balance || 0;
    const referrals = data.referCount || 0; // referCount ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã

    if (balance < selectedAmount) {
        status.textContent = '‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!'; status.style.color = 'red'; return;
    }
    if (referrals < 10) {
        status.textContent = `‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ßß‡ß¶ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶õ‡ßá: ${referrals}`; status.style.color = 'red'; return;
    }

    // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏
    const txnId = 'TXN-' + Date.now().toString().slice(-6);
    
    try {
        await db.collection('withdraws').add({
            userId: userId,
            amount: selectedAmount,
            method: selectedMethod,
            phone: config.code + phone,
            status: 'pending',
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            transactionId: txnId
        });

        // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶ü‡¶æ
        await userRef.update({
            balance: firebase.firestore.FieldValue.increment(-selectedAmount)
        });

        status.innerHTML = `‡¶∏‡¶´‡¶≤! ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø: ${txnId}`;
        status.style.color = 'green';
        phoneNumberInput.value = '';
        tg.showAlert('‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        
    } catch (e) {
        console.error(e);
        status.textContent = '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶è‡¶∞‡¶∞, ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
    }
};

// ‡¶ï‡¶æ‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ö‡ßá‡¶û‡ßç‡¶ú
document.getElementById('country-select').onchange = (e) => {
    selectedCountry = e.target.value;
    loadMethods(countries[selectedCountry]);
};

// ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶°
userRef.onSnapshot(doc => {
    if(doc.exists) {
        userData = doc.data();
        document.getElementById('balance').textContent = userData.balance || 0;
        document.getElementById('withdrawable-balance').textContent = (userData.balance || 0) + '‡ß≥';
    }
});

// ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
loadMethods(countries['bd']);
loadAmountSelector();
document.getElementById('user-name').textContent = user?.first_name || 'User';

</script>


</body>
</html>